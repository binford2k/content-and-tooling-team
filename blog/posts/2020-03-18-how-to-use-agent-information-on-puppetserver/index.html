<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/content-and-tooling-team/favicons/favicon.ico><link rel=apple-touch-icon href=/content-and-tooling-team/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-192x192.png sizes=192x192><title>How to use agent-side information on the puppetserver | Content and Tooling</title><meta name=description content="This question was posted on the Puppet Community Slack yesterday:

Is there any way like the below in puppet code we can use:
$var=‘run command …"><meta property="og:title" content="How to use agent-side information on the puppetserver"><meta property="og:description" content="This question was posted on the Puppet Community Slack yesterday:
 Is there any way like the below in puppet code we can use:
$var=‘run command locally on agent, if $?=0 echo “present”, else echo “absent”’ if $var == present { # my code } else { # something else }  (by user IlovPuppet, edited for presentation)
There are a number of reasons why this question comes up. First is likely that folks are not aware of the options available at all."><meta property="og:type" content="article"><meta property="og:url" content="https://puppetlabs.github.io/content-and-tooling-team/blog/posts/2020-03-18-how-to-use-agent-information-on-puppetserver/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-03-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-24T14:02:25+00:00"><meta itemprop=name content="How to use agent-side information on the puppetserver"><meta itemprop=description content="This question was posted on the Puppet Community Slack yesterday:
 Is there any way like the below in puppet code we can use:
$var=‘run command locally on agent, if $?=0 echo “present”, else echo “absent”’ if $var == present { # my code } else { # something else }  (by user IlovPuppet, edited for presentation)
There are a number of reasons why this question comes up. First is likely that folks are not aware of the options available at all."><meta itemprop=datePublished content="2020-03-18T00:00:00+00:00"><meta itemprop=dateModified content="2022-03-24T14:02:25+00:00"><meta itemprop=wordCount content="1086"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="How to use agent-side information on the puppetserver"><meta name=twitter:description content="This question was posted on the Puppet Community Slack yesterday:
 Is there any way like the below in puppet code we can use:
$var=‘run command locally on agent, if $?=0 echo “present”, else echo “absent”’ if $var == present { # my code } else { # something else }  (by user IlovPuppet, edited for presentation)
There are a number of reasons why this question comes up. First is likely that folks are not aware of the options available at all."><link rel=preload href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css as=style><link href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/content-and-tooling-team/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" id="svg3713" width="30" height="30" viewBox="0 0 30 30.000001" sodipodi:docname="puppet-logo-amber.svg" inkscape:version="0.92.4 (5da689c313, 2019-01-14)"><defs id="defs3717"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="2544" inkscape:window-height="1221" id="namedview3715" showgrid="false" inkscape:zoom="9.1657311" inkscape:cx="95.465911" inkscape:cy="-12.96395" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="g3721" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0"/><g id="g3721" inkscape:groupmode="layer" inkscape:label="Puppet-Logo-Mark-Amber" transform="matrix(1.3333333,0,0,-1.3333333,-30.985333,60.985317)"><path d="m32.416539 25.664063h-2.164731v2.16473h2.164731zm-2.164731 17.420479h2.164731v-2.16473h-2.164731zm11.960601-5.463051h-4.96675l.0015.0015-2.66579 2.66579v4.96057h-6.494368v-6.494377h4.966749l2.662712-2.662711.0016.0015v-3.439051l-.0032.0032-2.664205-2.664297v0H28.087v-6.494377h6.494377v4.963577.0l2.664204 2.664297h4.966843z" style="fill:#ffae1a;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:.09330733" id="path3723" inkscape:connector-curvature="0"/></g></svg></span><span class="text-uppercase font-weight-bold">Content and Tooling</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/pct/><span>PCT</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/prm/><span>PRM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/content-and-tooling-team/blog/><span class=active>Blog</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblog-li><a href=/content-and-tooling-team/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-content-and-tooling-teamblog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblogposts-li><a href=/content-and-tooling-team/blog/posts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogposts><span>Posts</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsprm-initial-release-li><a href=/content-and-tooling-team/blog/posts/prm-initial-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsprm-initial-release><span>Puppet Runtime Manager 0.1.0 Release 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell-li><a href=/content-and-tooling-team/blog/posts/2021-10-20-fond-farewell/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell><span>A Fond Farewell For Now to Community Day & Norman</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsfuture-of-pdk-li><a href=/content-and-tooling-team/blog/posts/future-of-pdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsfuture-of-pdk><span>The future of the Puppet Developer Kit (PDK)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release-li><a href=/content-and-tooling-team/blog/posts/2021-06-04-pct-early-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release><span>Puppet Content Templates 0.1.0 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp-li><a href=/content-and-tooling-team/blog/posts/2021-05-07-running-multinode-modules-gcp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp><span>Run multi-node module tests with cloud continuous integration (CI) in Google Cloud Platform (GCP)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/posts/>View More</a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-content-and-tooling-teamblogupdates-li><a href=/content-and-tooling-team/blog/updates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogupdates><span>Updates</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-11-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update><span>2021-10-11: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-04-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update><span>2021-10-04: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-20-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update><span>2021-09-20: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-13-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update><span>2021-09-13: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-06-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update><span>2021-09-06: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/updates/>View More</a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/puppetlabs/content-and-tooling-team/edit/main/content/en/blog/posts/2020-03-18-how-to-use-agent-information-on-puppetserver.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/puppetlabs/content-and-tooling-team/new/main/content/en/blog/posts/2020-03-18-how-to-use-agent-information-on-puppetserver.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/discussions/new target=_blank><i class="fas fa-comments fa-fw"></i> Create new discussion topic</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#explicit-decisions>Explicit Decisions</a></li><li><a href=#deferred><code>Deferred</code></a></li><li><a href=#exec-resources><code>exec</code> resources</a></li><li><a href=#custom-facts>Custom Facts</a></li><li><a href=#custom-resources>Custom Resources</a></li><li><a href=#final-words>Final Words</a></li></ul></nav></div><script>function revealTags(a){console.log(a);var b=document.getElementsByClassName("hidden");for(let c of b)c.id.split("--")[0]==a&&(c.style.display="inline-block");document.getElementById(a).remove()}</script><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/updates/ data-taxonomy-term=updates><span class=taxonomy-label>updates</span><span class=taxonomy-count>82</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/content/ data-taxonomy-term=content><span class=taxonomy-label>content</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/tooling/ data-taxonomy-term=tooling><span class=taxonomy-label>tooling</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/team/ data-taxonomy-term=team><span class=taxonomy-label>team</span><span class=taxonomy-count>4</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>How to use agent-side information on the puppetserver</h1><div class="td-byline mb-4">By <b>dev_el_ops</b> |
<time datetime=2020-03-18 class=text-muted>Wednesday, March 18, 2020</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/content/ data-taxonomy-term=content><span class=taxonomy-label>content</span></a></li></ul></div></header><p>This question was posted on the <a href=https://slack.puppet.com/>Puppet Community Slack</a> yesterday:</p><blockquote><p>Is there any way like the below in puppet code we can use:</p><pre><code>$var=‘run command locally on agent, if $?=0 echo “present”, else echo “absent”’
if $var == present {
  # my code
} else {
  # something else
}
</code></pre></blockquote><p>(by user <a href=https://app.slack.com/team/URGFPBS0N>IlovPuppet</a>, edited for presentation)</p><p>There are a number of reasons why this question comes up.
First is likely that folks are not aware of the options available at all.
Then, sometimes, the common options (like custom facts) just don&rsquo;t cut it for security or performance reasons.
Last but not least, organisational and technical circumstances can make one option more appealing than others.</p><p>From my answer there, I wrote up a more detailed exposition here.
Based on the specifics of your situation,
there are several different options to solve this,
described in detail below:</p><ul><li>make the decision explicit</li><li>a <code>Deferred</code> function call</li><li>using <code>onlyif</code> or <code>unless</code> on an <code>exec</code> resource</li><li>a custom fact</li><li>a custom resource</li></ul><h2 id=explicit-decisions>Explicit Decisions</h2><p><strong>What is it?</strong></p><p>Puppet shines when we can make our configuration decisions explicit.
Make the dynamic decision a static configuration and ensure that whatever is producing the different states is also managed by puppet.
Having a hard look at what the command is trying to decide and whether this couldn&rsquo;t be enforced instead of queried can save complexity.</p><p><strong>Example</strong></p><p>A simple example from my past as a technical consultant is a client who wanted to base a configuration decision off whether or not a particular package was installed on a workstation. In this particular case it turned out that installing that additional package was not very expensive (compared to coding up a dynamic solution), so we just rolled out the package to everyone and removed another thing that was different across the fleet.</p><p><strong>Use it &mldr;</strong></p><ul><li>if you can take control of the source of your question.</li><li>if you can key off another configuration instead of querying active system state.</li><li>if you can make your general configuration easier by removing a source of variation.</li><li>if the query code is difficult and/or unreliable.</li></ul><p><strong>Don&rsquo;t use it if &mldr;</strong></p><ul><li>the input is truly dynamic.</li><li>the configuration is outside of your organisational scope (but try talking to the other team first!).</li><li>the computed value is sensitive and should not be transmitted or stored outside the node.</li></ul><h2 id=deferred><code>Deferred</code></h2><p><strong>What is it?</strong></p><p>The <code>Deferred</code> function computes a value on the agent everytime the catalog is executed and uses the value immediately in the catalog.</p><p><strong>Example</strong></p><p>The <a href=https://forge.puppet.com/puppet/vault_lookup>puppet/vault_lookup</a> module shows how to use <code>Deferred</code> with its <code>vault_lookup::lookup</code> function:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-puppet data-lang=puppet><span style=color:#8be9fd;font-style:italic>$d</span> <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>Deferred</span>(<span style=color:#f1fa8c>&#39;vault_lookup::lookup&#39;</span>, [<span style=color:#f1fa8c>&#34;secret/test&#34;</span>, <span style=color:#f1fa8c>&#39;https://vault.hostname:8200&#39;</span>])

<span style=color:#ff79c6>node</span> <span style=color:#ff79c6>default</span> {
  <span style=color:#ff79c6>notify</span> { <span style=color:#50fa7b>example</span> :
    <span style=color:#50fa7b>message</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$d</span>
  }
}
</code></pre></div><p>(from <a href=https://github.com/voxpupuli/puppet-vault_lookup#usage>voxpupuli/puppet-vault_lookup</a>)</p><p><strong>Use it &mldr;</strong></p><ul><li>for values specific to one or a few agents, for which managing via Hiera would be cumbersome.</li><li>for sensitive values that should not be exposed outside the individual agent.</li><li>for setting properties on resources.</li></ul><p><strong>Don&rsquo;t use it if &mldr;</strong></p><ul><li>you need to change <strong>which</strong> resources are managed.</li><li>you need the value in PE Console for classification or reporting.</li><li>the computed value depends on resources managed earlier in the catalog.</li><li>a simpler solution (see above) works.</li></ul><p><strong>Further Reading</strong></p><ul><li><a href=https://puppet.com/docs/puppet/latest/write_a_puppet_function_to_store_secrets.html>Write a Puppet function to store secrets</a>: the original use-case for <code>Deferred</code></li><li><a href=http://puppet-on-the-edge.blogspot.com/2018/10/the-topic-is-deferred.html>The Topic is Deferred</a>: blogpost with hints and tricks how to use <code>Deferred</code></li><li><a href=https://binford2k.com/2019/11/12/deferred-functions/>Agent Side Functions in Puppet 6</a>: technical deep-dive on how <code>Deferred</code> works</li><li><a href=https://www.hashicorp.com/resources/agent-side-lookups-with-hashicorp-vault-puppet-6>HashiCorp Vault 🧡 Puppet6 webinar</a>: deferred functions in Puppet 6, which unlocks new authentication methods and workflows for HashiCorp Vault + Puppet setups.</li></ul><h2 id=exec-resources><code>exec</code> resources</h2><p><strong>What is it?</strong></p><p>The <code>exec</code> resource has attributes to dynamically decide to run the managed command or not.
By passing a command to <code>onlyif</code> or <code>unless</code> the command is executed <em>only if</em> or <em>unless</em> the condition successfully executes.
Use <code>refreshonly</code> to react to another resource being changed.</p><p><strong>Example</strong></p><p>The <a href=https://forge.puppet.com/puppetlabs/mysql>mysql module</a> has this <code>exec</code> resource to clean up after installation. This should never run after <code>${secret_file}</code> has been dealt with.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-puppet data-lang=puppet><span style=color:#ff79c6>exec</span> { <span style=color:#f1fa8c>&#39;remove install pass&#39;</span>:
  <span style=color:#50fa7b>command</span> <span style=color:#ff79c6>=&gt;</span> <span style=color:#8be9fd;font-style:italic>$rm_pass_cmd,</span>
  <span style=color:#50fa7b>onlyif</span>  <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;test -f ${secret_file}&#34;</span>,
  <span style=color:#50fa7b>path</span>    <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#39;/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin&#39;</span>
}
</code></pre></div><p>(from <a href=https://github.com/puppetlabs/puppetlabs-mysql/blob/312aca80ba7699ab37f9051d871aac2e05b217b3/manifests/server/root_password.pp#L20-L24>root_password.pp</a>)</p><p><strong>Use it for &mldr;</strong></p><ul><li>running one-off commands on a condition.</li></ul><p><strong>Don&rsquo;t use it if &mldr;</strong></p><ul><li>an exec is not a good fit for your problem.</li><li>the condition is very complex or timeconsuming.</li><li>the condition has to be repeated often.</li></ul><p><strong>Further Reading</strong></p><ul><li><a href=https://puppet.com/docs/puppet/latest/types/exec.html>Resource Type: <code>exec</code></a></li></ul><h2 id=custom-facts>Custom Facts</h2><p><strong>What is it?</strong></p><p>Custom facts are distributed to Puppet clients and are available for use in manifests and templates,
just like any other fact is.
They can be used to write conditional expressions based on site-specific data that isn’t available via Facter.</p><p><strong>Example</strong></p><p>The apt module has a few <a href=https://github.com/puppetlabs/puppetlabs-apt#facts>custom facts</a>. The <code>apt_update_last_success</code> fact is used in <a href=https://github.com/puppetlabs/puppetlabs-apt/blob/master/manifests/update.pp>update.pp</a> to decide whether or not it is necessary to update apt caches depending on the various configurations specified.</p><p><strong>Use it &mldr;</strong></p><ul><li>when you need to centrally collect and evaluate the values.</li><li>when you want to get the value from all your nodes.</li><li>to change the set of resources and classes included for each node.</li></ul><p><strong>Don&rsquo;t use it if &mldr;</strong></p><ul><li>the computed value is sensitive and should not be transmitted or stored outside the node.</li><li>a simpler solution (see above) works.</li></ul><p><strong>Further Reading</strong></p><ul><li><a href=https://puppet.com/docs/puppet/latest/fact_overview.html>Custom facts</a>: the current puppet documentation</li><li><a href=https://puppet.com/docs/puppet/latest/custom_facts.html>Custom facts walkthrough</a>: how to write your own facts</li><li><a href=https://glennsarti.github.io/blog/puppet-ruby-facts/>Starting out with Puppet custom facts</a>: a quick start to converting external facts to ruby custom facts on Windows</li></ul><h2 id=custom-resources>Custom Resources</h2><p><strong>What is it?</strong></p><p>With a native ruby plugin you can fully take control of how puppet manages a resource. Through this you get fine-grained control over reporting and enforcing system state through puppet.</p><p><strong>Example</strong></p><p>The <a href=https://forge.puppet.com/puppetlabs/mysql>mysql module</a> contains custom types and providers to control databases, users and grants.</p><blockquote><p>Note that the mysql module is still using the low-level API. Using the PDK and the Resource API, programming types and providers has become a lot easier as of late. Check out the &ldquo;Further Reading&rdquo; section below.</p></blockquote><p><strong>Use it for &mldr;</strong></p><ul><li>things that can be modeled as a puppet resource.</li><li>fine-grained control.</li><li>full integration into the puppet tooling.</li></ul><p><strong>Don&rsquo;t use it if &mldr;</strong></p><ul><li>you do not want to code ruby.</li><li>a simpler solution (see above) works.</li></ul><p><strong>Further Reading</strong></p><ul><li><a href=https://puppet.com/docs/puppet/latest/custom_resources.html>Custom Resources</a>: main documentation on writing custom resources.</li><li><a href=https://github.com/puppetlabs/puppet-resource_api/tree/master/docs>HUE hands on lab</a>: hands-on lab for a custom remote resource interacting with a API.</li></ul><h2 id=final-words>Final Words</h2><p>To summarize, Puppet provides you with a number of alternatives to make your configuration smarter.
Thanks to IluvPuppet for the great question, and <a href=https://github.com/hpcprofessional>Paul Anderson</a> and Paul Reed for reviewing and feedback.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/content-and-tooling-team/blog/posts/2020-02-19-infrastructure-for-the-gem/ aria-label="Previous - Setting up basic infrastructure for your gem" class="btn btn-primary"><span class=mr-1>←</span>Previous</a></li><a href=/content-and-tooling-team/blog/posts/2020-03-30-dsc-announcement/ aria-label="Next - DSC + Puppet: Incoming!" class="btn btn-primary">Next<span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/puppetize aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://puppetcommunity.slack.com/ aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/puppetlabs/content-and-tooling-team aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Puppet All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script><script src=/content-and-tooling-team/js/tabpane-persist.js></script><script src=/content-and-tooling-team/js/main.min.20a756bd86e5baf68cf7cef0159a97a60c58d42f04b8b13448fe311997b49fda.js integrity="sha256-IKdWvYbluvaM987wFZqXpgxY1C8EuLE0SP4xGZe0n9o=" crossorigin=anonymous></script></body></html>