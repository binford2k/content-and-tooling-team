<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/content-and-tooling-team/favicons/favicon.ico><link rel=apple-touch-icon href=/content-and-tooling-team/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-192x192.png sizes=192x192><title>Gem Testing with pdksync | Content and Tooling</title><meta name=description content="Introduction
pdksync enables you to do a lot more than just pdk update against a set of defined modules. In this blog post we will be going through …"><meta property="og:title" content="Gem Testing with pdksync"><meta property="og:description" content="Introduction pdksync enables you to do a lot more than just pdk update against a set of defined modules. In this blog post we will be going through single or multi gem testing features of pdksync.
Setup Download a fork of the repo, which can be found here pdksync. Or you can install via Rubygems, it can be found here pdksync. Install gems by using bundle install. Ensure you have a GITHUB_TOKEN set in your env, if you don&rsquo;t add it by running export GITHUB_TOKEN=<your github token>, this is required for authentication."><meta property="og:type" content="article"><meta property="og:url" content="https://puppetlabs.github.io/content-and-tooling-team/blog/posts/2020-02-12-gem-testing-with-pdksync/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-02-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-24T14:02:25+00:00"><meta itemprop=name content="Gem Testing with pdksync"><meta itemprop=description content="Introduction pdksync enables you to do a lot more than just pdk update against a set of defined modules. In this blog post we will be going through single or multi gem testing features of pdksync.
Setup Download a fork of the repo, which can be found here pdksync. Or you can install via Rubygems, it can be found here pdksync. Install gems by using bundle install. Ensure you have a GITHUB_TOKEN set in your env, if you don&rsquo;t add it by running export GITHUB_TOKEN=<your github token>, this is required for authentication."><meta itemprop=datePublished content="2020-02-12T00:00:00+00:00"><meta itemprop=dateModified content="2022-03-24T14:02:25+00:00"><meta itemprop=wordCount content="665"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Gem Testing with pdksync"><meta name=twitter:description content="Introduction pdksync enables you to do a lot more than just pdk update against a set of defined modules. In this blog post we will be going through single or multi gem testing features of pdksync.
Setup Download a fork of the repo, which can be found here pdksync. Or you can install via Rubygems, it can be found here pdksync. Install gems by using bundle install. Ensure you have a GITHUB_TOKEN set in your env, if you don&rsquo;t add it by running export GITHUB_TOKEN=<your github token>, this is required for authentication."><link rel=preload href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css as=style><link href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/content-and-tooling-team/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" id="svg3713" width="30" height="30" viewBox="0 0 30 30.000001" sodipodi:docname="puppet-logo-amber.svg" inkscape:version="0.92.4 (5da689c313, 2019-01-14)"><defs id="defs3717"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="2544" inkscape:window-height="1221" id="namedview3715" showgrid="false" inkscape:zoom="9.1657311" inkscape:cx="95.465911" inkscape:cy="-12.96395" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="g3721" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0"/><g id="g3721" inkscape:groupmode="layer" inkscape:label="Puppet-Logo-Mark-Amber" transform="matrix(1.3333333,0,0,-1.3333333,-30.985333,60.985317)"><path d="m32.416539 25.664063h-2.164731v2.16473h2.164731zm-2.164731 17.420479h2.164731v-2.16473h-2.164731zm11.960601-5.463051h-4.96675l.0015.0015-2.66579 2.66579v4.96057h-6.494368v-6.494377h4.966749l2.662712-2.662711.0016.0015v-3.439051l-.0032.0032-2.664205-2.664297v0H28.087v-6.494377h6.494377v4.963577.0l2.664204 2.664297h4.966843z" style="fill:#ffae1a;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:.09330733" id="path3723" inkscape:connector-curvature="0"/></g></svg></span><span class="text-uppercase font-weight-bold">Content and Tooling</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/pct/><span>PCT</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/prm/><span>PRM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/content-and-tooling-team/blog/><span class=active>Blog</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblog-li><a href=/content-and-tooling-team/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-content-and-tooling-teamblog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblogposts-li><a href=/content-and-tooling-team/blog/posts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogposts><span>Posts</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsprm-initial-release-li><a href=/content-and-tooling-team/blog/posts/prm-initial-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsprm-initial-release><span>Puppet Runtime Manager 0.1.0 Release 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell-li><a href=/content-and-tooling-team/blog/posts/2021-10-20-fond-farewell/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell><span>A Fond Farewell For Now to Community Day & Norman</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsfuture-of-pdk-li><a href=/content-and-tooling-team/blog/posts/future-of-pdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsfuture-of-pdk><span>The future of the Puppet Developer Kit (PDK)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release-li><a href=/content-and-tooling-team/blog/posts/2021-06-04-pct-early-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release><span>Puppet Content Templates 0.1.0 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp-li><a href=/content-and-tooling-team/blog/posts/2021-05-07-running-multinode-modules-gcp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp><span>Run multi-node module tests with cloud continuous integration (CI) in Google Cloud Platform (GCP)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/posts/>View More</a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-content-and-tooling-teamblogupdates-li><a href=/content-and-tooling-team/blog/updates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogupdates><span>Updates</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-11-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update><span>2021-10-11: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-04-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update><span>2021-10-04: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-20-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update><span>2021-09-20: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-13-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update><span>2021-09-13: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-06-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update><span>2021-09-06: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/updates/>View More</a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/puppetlabs/content-and-tooling-team/edit/main/content/en/blog/posts/2020-02-12-gem-testing-with-pdksync.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/puppetlabs/content-and-tooling-team/new/main/content/en/blog/posts/2020-02-12-gem-testing-with-pdksync.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/discussions/new target=_blank><i class="fas fa-comments fa-fw"></i> Create new discussion topic</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#setup>Setup</a></li><li><a href=#part-one-functionality-single-gem-testing>Part One: Functionality Single Gem Testing</a><ul><li></li></ul></li><li><a href=#part-two-functionality-multi-gem-testing>Part Two: Functionality Multi Gem Testing</a></li><li><a href=#wrapping-up>Wrapping Up</a></li></ul></nav></div><script>function revealTags(a){console.log(a);var b=document.getElementsByClassName("hidden");for(let c of b)c.id.split("--")[0]==a&&(c.style.display="inline-block");document.getElementById(a).remove()}</script><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/updates/ data-taxonomy-term=updates><span class=taxonomy-label>updates</span><span class=taxonomy-count>82</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/content/ data-taxonomy-term=content><span class=taxonomy-label>content</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/tooling/ data-taxonomy-term=tooling><span class=taxonomy-label>tooling</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/team/ data-taxonomy-term=team><span class=taxonomy-label>team</span><span class=taxonomy-count>4</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>Gem Testing with pdksync</h1><div class="td-byline mb-4">By <b>sheenaajay</b> |
<time datetime=2020-02-12 class=text-muted>Wednesday, February 12, 2020</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/tooling/ data-taxonomy-term=tooling><span class=taxonomy-label>tooling</span></a></li></ul></div></header><h2 id=introduction>Introduction</h2><p>pdksync enables you to do a lot more than just pdk update against a set of defined modules. In this blog post we will be going through single or multi gem testing features of pdksync.</p><h2 id=setup>Setup</h2><p>Download a fork of the repo, which can be found here <a href=https://github.com/puppetlabs/pdksync>pdksync</a>. Or you can install via Rubygems, it can be found here <a href=https://rubygems.org/gems/pdksync>pdksync</a>.
Install gems by using <code>bundle install</code>.
Ensure you have a GITHUB_TOKEN set in your env, if you don&rsquo;t add it by running <code>export GITHUB_TOKEN=&lt;your github token></code>, this is required for authentication.
Important - Manually edit the list contained in &lsquo;managed_modules.yml&rsquo; to ensure it is correct with the modules you wish to update. Please note this is critical as this tool will create PRs against the repos included in this list - you don&rsquo;t want to run this against a module you aren&rsquo;t familiar with. Do not proceed to the next step without doing this.
Run the rake task by using <code>bundle exec rake pdksync</code>.</p><h2 id=part-one-functionality-single-gem-testing>Part One: Functionality Single Gem Testing</h2><p>pdksync tool comes with the feature to update the Gemfile. Puppet provides a lot of useful gems to access and manage their functionality between modules. This functionality will help user to perform gem testing prior to release. User is given new rake tasks to update SHA/Version/Branch/line in the Gemfile. Then the changes can be committed, PR can be created which will run the acceptance tests in the PR. If all the tests are executing successfully then the user can close the PRS and release the gem.</p><blockquote><h4 id=note>Note:</h4><p>It assumes very limited familiarity with the <a href=https://github.com/puppetlabs/pdksync>pdksync</a> and <a href=https://puppet.com/blog/keep-your-puppet-modules-up-to-date-pdk/>pdk</a></p></blockquote><p>Run gem_file_update against modules</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:gem_file_update<span style=color:#ff79c6>[</span>:gem_to_test, :gem_line, :gem_sha_finder, :gem_sha_replacer, :gem_version_finder, :gem_version_replacer, :gem_branch_finder, :gem_branch_replacer<span style=color:#ff79c6>]</span>
</code></pre></div><p>eg rake to update gem line</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:gem_file_update<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet_litmus&#39;</span>, <span style=color:#f1fa8c>&#34;gem &#39;puppet_litmus&#39;\, git: &#39;https://github.com/test/puppet_litmus.git&#39;\, branch: &#39;testbranch&#39;&#34;</span><span style=color:#ff79c6>]</span>&#39;
</code></pre></div><p>eg rake to update sha</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:gem_file_update<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet_litmus&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;20ee04ba1234e9e83eb2ffb5056e23d641c7a018&#39;</span>, <span style=color:#f1fa8c>&#39;20ee04ba1234e9e83eb2ffb5056e23d641c7a31&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>eg rake to update version</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:gem_file_update<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet_litmus&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#34;= 0.9.0&#34;</span>, <span style=color:#f1fa8c>&#34;&lt;= 0.10.0&#34;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>eg rake to update branch</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:gem_file_update<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet_litmus&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>, <span style=color:#f1fa8c>&#39;testbranch&#39;</span>, <span style=color:#f1fa8c>&#39;testbranches&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>Below given are the workflows for doing single gem testing with pdksync.</p><p>In Workflow 1 we can clone modules, update the gem file, create the commit, push the changes and create the PR using separate rake tasks.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bundle install --path .bundle/gems/
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake git:clone_managed_modules
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;pdksync:gem_file_update[]&#39;</span>
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;git:create_commit[]&#39;</span>
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;git:push&#39;</span>
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;git:create_pr[]&#39;</span>
</code></pre></div><p>In Workflow 2 we can clone modules, update the gem file, create the commit, push the changes and create the PR using single rake task</p><pre><code>Using single rake job
bundle install --path .bundle/gems/
bundle exec rake 'gem_testing[]'
</code></pre><p>Once the verified gem is released we can use pdksync to update the the new version of gem released in the <code>.sync.yaml</code> file.</p><h2 id=part-two-functionality-multi-gem-testing>Part Two: Functionality Multi Gem Testing</h2><p>pdksync tool is extended with the feature to perform multi gem testing (<code>puppet-module-gems</code>). This functionality will identify the current version and bump the version by one. Then it will build and push the gems to gemfury account. Export the GEMFURY_TOKEN to use this rake task.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>GEMFURY_TOKEN</span><span style=color:#ff79c6>=</span>&lt;access_token&gt;
</code></pre></div><p>Run the following commands to check that everything is working as expected:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bundle install --path .bundle/gems/
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake -T
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;git:clone_gem[puppet-module-gems]&#39;</span>
</code></pre></div><p>Run multigem_file_update against modules:</p><p>Clone gem</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git:clone_gem<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet-module-gems&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>Build and Push new gems built to the gemfury account for testing</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:multi_gem_testing<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet-module-gems&#39;</span>,<span style=color:#f1fa8c>&#39;config/info.yml&#39;</span>,<span style=color:#f1fa8c>&#39;exe/build-gems.rb&#39;</span>,<span style=color:#f1fa8c>&#39;pkg&#39;</span>,<span style=color:#f1fa8c>&#39;gem_tester&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>Update Gemfile of the modules with the new gem should be pushed to Gemfury.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pdksync:multigem_file_update<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>&#39;puppet-module&#39;</span>,<span style=color:#f1fa8c>&#39;tester&#39;</span><span style=color:#ff79c6>]</span>
</code></pre></div><p>Below given is the workflows for doing multi gem testing with pdksync.</p><p>In this workflow we can clone gems, update the version, build the gem, push the changes to gemfury and update the gem file of the required modules with the latest gem updated in the fury. Then we can create PR or run tests locally or run tests through jenkins to verify the module test results.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>bundle install --path .bundle/gems/
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;git:clone_gem[puppet-module-gems]&#39;</span>
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;pdksync:multi_gem_testing[]&#39;</span>
bundle <span style=color:#8be9fd;font-style:italic>exec</span> rake <span style=color:#f1fa8c>&#39;pdksync:multigem_file_update[]&#39;</span>
</code></pre></div><h2 id=wrapping-up>Wrapping Up</h2><p>These are the steps that we can follow to perform single or multi gem testing using pdksync.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/content-and-tooling-team/blog/posts/2020-02-05-powershell-type-and-provider-i/ aria-label="Previous - Developing a PowerShell-Dependent Puppet Type & Provider" class="btn btn-primary"><span class=mr-1>←</span>Previous</a></li><a href=/content-and-tooling-team/blog/posts/2020-02-19-infrastructure-for-the-gem/ aria-label="Next - Setting up basic infrastructure for your gem" class="btn btn-primary">Next<span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/puppetize aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://puppetcommunity.slack.com/ aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/puppetlabs/content-and-tooling-team aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Puppet All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script><script src=/content-and-tooling-team/js/tabpane-persist.js></script><script src=/content-and-tooling-team/js/main.min.20a756bd86e5baf68cf7cef0159a97a60c58d42f04b8b13448fe311997b49fda.js integrity="sha256-IKdWvYbluvaM987wFZqXpgxY1C8EuLE0SP4xGZe0n9o=" crossorigin=anonymous></script></body></html>