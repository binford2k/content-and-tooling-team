<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/content-and-tooling-team/favicons/favicon.ico><link rel=apple-touch-icon href=/content-and-tooling-team/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/content-and-tooling-team/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/content-and-tooling-team/favicons/android-192x192.png sizes=192x192><title>Apache MOD Test Maintenance | Content and Tooling</title><meta name=description content="This week sees version v5.5.0 of the puppetlabs-apache module released.
There are a lot of new features within this release - check out the CHANGELOG …"><meta property="og:title" content="Apache MOD Test Maintenance"><meta property="og:description" content="This week sees version v5.5.0 of the puppetlabs-apache module released. There are a lot of new features within this release - check out the CHANGELOG entry for this version to see what&rsquo;s included.
The last release of this module was v5.4.0 on 2020-01-23, over 5 months ago. Currently the IAC Team is responsible for [these supported modules]({% link modules.html %}) and [tools]({% link tools.html %}). As a small team we always continue to improve our processes to ensure we&rsquo;re maximising our time and efforts."><meta property="og:type" content="article"><meta property="og:url" content="https://puppetlabs.github.io/content-and-tooling-team/blog/posts/2020-07-03-apache-mod-test-improvements/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-07-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-24T14:02:25+00:00"><meta itemprop=name content="Apache MOD Test Maintenance"><meta itemprop=description content="This week sees version v5.5.0 of the puppetlabs-apache module released. There are a lot of new features within this release - check out the CHANGELOG entry for this version to see what&rsquo;s included.
The last release of this module was v5.4.0 on 2020-01-23, over 5 months ago. Currently the IAC Team is responsible for [these supported modules]({% link modules.html %}) and [tools]({% link tools.html %}). As a small team we always continue to improve our processes to ensure we&rsquo;re maximising our time and efforts."><meta itemprop=datePublished content="2020-07-03T00:00:00+00:00"><meta itemprop=dateModified content="2022-03-24T14:02:25+00:00"><meta itemprop=wordCount content="1264"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache MOD Test Maintenance"><meta name=twitter:description content="This week sees version v5.5.0 of the puppetlabs-apache module released. There are a lot of new features within this release - check out the CHANGELOG entry for this version to see what&rsquo;s included.
The last release of this module was v5.4.0 on 2020-01-23, over 5 months ago. Currently the IAC Team is responsible for [these supported modules]({% link modules.html %}) and [tools]({% link tools.html %}). As a small team we always continue to improve our processes to ensure we&rsquo;re maximising our time and efforts."><link rel=preload href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css as=style><link href=/content-and-tooling-team/scss/main.min.708b8eb536aa0debb8b80098b7381547f2d71482d991ac4d1a493e8e52687dc0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/content-and-tooling-team/><span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" id="svg3713" width="30" height="30" viewBox="0 0 30 30.000001" sodipodi:docname="puppet-logo-amber.svg" inkscape:version="0.92.4 (5da689c313, 2019-01-14)"><defs id="defs3717"/><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="2544" inkscape:window-height="1221" id="namedview3715" showgrid="false" inkscape:zoom="9.1657311" inkscape:cx="95.465911" inkscape:cy="-12.96395" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="g3721" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0"/><g id="g3721" inkscape:groupmode="layer" inkscape:label="Puppet-Logo-Mark-Amber" transform="matrix(1.3333333,0,0,-1.3333333,-30.985333,60.985317)"><path d="m32.416539 25.664063h-2.164731v2.16473h2.164731zm-2.164731 17.420479h2.164731v-2.16473h-2.164731zm11.960601-5.463051h-4.96675l.0015.0015-2.66579 2.66579v4.96057h-6.494368v-6.494377h4.966749l2.662712-2.662711.0016.0015v-3.439051l-.0032.0032-2.664205-2.664297v0H28.087v-6.494377h6.494377v4.963577.0l2.664204 2.664297h4.966843z" style="fill:#ffae1a;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:.09330733" id="path3723" inkscape:connector-curvature="0"/></g></svg></span><span class="text-uppercase font-weight-bold">Content and Tooling</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/pct/><span>PCT</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/content-and-tooling-team/prm/><span>PRM</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/content-and-tooling-team/blog/><span class=active>Blog</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblog-li><a href=/content-and-tooling-team/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-content-and-tooling-teamblog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-content-and-tooling-teamblogposts-li><a href=/content-and-tooling-team/blog/posts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogposts><span>Posts</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsprm-initial-release-li><a href=/content-and-tooling-team/blog/posts/prm-initial-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsprm-initial-release><span>Puppet Runtime Manager 0.1.0 Release 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell-li><a href=/content-and-tooling-team/blog/posts/2021-10-20-fond-farewell/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-10-20-fond-farewell><span>A Fond Farewell For Now to Community Day & Norman</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogpostsfuture-of-pdk-li><a href=/content-and-tooling-team/blog/posts/future-of-pdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogpostsfuture-of-pdk><span>The future of the Puppet Developer Kit (PDK)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release-li><a href=/content-and-tooling-team/blog/posts/2021-06-04-pct-early-release/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-06-04-pct-early-release><span>Puppet Content Templates 0.1.0 🚀</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp-li><a href=/content-and-tooling-team/blog/posts/2021-05-07-running-multinode-modules-gcp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogposts2021-05-07-running-multinode-modules-gcp><span>Run multi-node module tests with cloud continuous integration (CI) in Google Cloud Platform (GCP)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/posts/>View More</a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-content-and-tooling-teamblogupdates-li><a href=/content-and-tooling-team/blog/updates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-content-and-tooling-teamblogupdates><span>Updates</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-11-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-11-status-update><span>2021-10-11: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-10-04-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-10-04-status-update><span>2021-10-04: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-20-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-20-status-update><span>2021-09-20: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-13-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-13-status-update><span>2021-09-13: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update-li><a href=/content-and-tooling-team/blog/updates/2021-09-06-status-update/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-content-and-tooling-teamblogupdates2021-09-06-status-update><span>2021-09-06: IAC & DevX Team Status Update</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child"><a href=https://puppetlabs.github.io/content-and-tooling-team/blog/updates/>View More</a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/puppetlabs/content-and-tooling-team/edit/main/content/en/blog/posts/2020-07-03-apache-mod-test-improvements.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/puppetlabs/content-and-tooling-team/new/main/content/en/blog/posts/2020-07-03-apache-mod-test-improvements.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/issues/new/choose target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a href=https://github.com/puppetlabs/content-and-tooling-team/discussions/new target=_blank><i class="fas fa-comments fa-fw"></i> Create new discussion topic</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#why-the-delay>Why the delay?</a></li><li><a href=#what-was-the-issue>What was the issue?</a></li><li><a href=#solution>Solution</a><ul><li><a href=#test-support-policy>Test Support Policy</a></li><li><a href=#mods-arent-supported-anymore>MODs aren&rsquo;t supported anymore!?</a></li><li><a href=#i-cant-get-the-test-to-pass-on-all-platforms>I can&rsquo;t get the test to pass on all platforms!</a></li><li><a href=#weve-agreed-were-not-supporting-this-mod-on-this-os-version---what-now>We&rsquo;ve agreed we&rsquo;re not supporting this MOD on this OS version - what now?</a></li><li><a href=#tagging-and-helper-methods>Tagging and Helper Methods</a></li></ul></li></ul></nav></div><script>function revealTags(a){console.log(a);var b=document.getElementsByClassName("hidden");for(let c of b)c.id.split("--")[0]==a&&(c.style.display="inline-block");document.getElementById(a).remove()}</script><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/updates/ data-taxonomy-term=updates><span class=taxonomy-label>updates</span><span class=taxonomy-count>82</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/content/ data-taxonomy-term=content><span class=taxonomy-label>content</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/tooling/ data-taxonomy-term=tooling><span class=taxonomy-label>tooling</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/team/ data-taxonomy-term=team><span class=taxonomy-label>team</span><span class=taxonomy-count>4</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>Apache MOD Test Maintenance</h1><div class="td-byline mb-4">By <b>sanfrancrisko</b> |
<time datetime=2020-07-03 class=text-muted>Friday, July 03, 2020</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-categories"><h5 class=taxonomy-title>Categories:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://puppetlabs.github.io/content-and-tooling-team/categories/content/ data-taxonomy-term=content><span class=taxonomy-label>content</span></a></li></ul></div></header><p>This week sees version <code>v5.5.0</code> of the <a href=https://forge.puppet.com/puppetlabs/apache>puppetlabs-apache</a> module released.
There are a lot of new features within this release - check out the <a href=https://forge.puppet.com/puppetlabs/apache/changelog#v550-2020-07-01>CHANGELOG entry for this version</a> to see what&rsquo;s included.</p><p>The last release of this module was <code>v5.4.0</code> on <code>2020-01-23</code>, over 5 months ago.
Currently the IAC Team is responsible for [these supported modules]({% link modules.html %}) and [tools]({% link tools.html %}).
As a small team we always continue to improve our processes to ensure we&rsquo;re maximising our time and efforts.
Still, the gap in time between the release of <code>v5.4.0</code> and <code>v5.5.0</code> of the <a href=https://forge.puppet.com/puppetlabs/apache>puppetlabs-apache</a> module was a concern for us.
What happened and how did we address this issue?</p><h2 id=why-the-delay>Why the delay?</h2><p>There was no shortage of excellent community contributions to the <a href=https://github.com/puppetlabs/puppetlabs-apache>puppetlabs-apache</a> module in the period between these two releases.
The team were keen to get a new release of the module out sooner than this, so the community could take advantage of these contributions.
Part of the process of releasing a module involves us running our release check suite on our internal VM infrastructure.
We were finding that there were cases where tests for <a href=https://httpd.apache.org/docs/2.4/mod>Apache MODs</a> were failing on certain platforms after someone in the community put forward a fix.</p><h2 id=what-was-the-issue>What was the issue?</h2><p>There are multiple reasons we ended up in this scenario, which ultimately had the same root cause, namely, a lack of test coverage.
Some examples are:</p><ul><li>New platforms changing MOD package names (e.g. <a href=https://github.com/farebers>farebers&rsquo;s</a> fix in <a href=https://github.com/puppetlabs/puppetlabs-apache/pull/2021>#2021</a>)</li><li><a href=https://github.com/puppetlabs/puppetlabs-apache/pull/1913>Fixes for one environment</a> having a knock-on effect for a <a href=https://github.com/puppetlabs/puppetlabs-apache/pull/2041>different environment</a> (thanks to <a href=https://github.com/h-haaks>h-haaks</a> for the fix!)</li></ul><p>When a new version of an OS comes out, it is quite common for issues to manifest when trying to configure some of the less mainstream <a href=https://httpd.apache.org/docs/2.4/mod>Apache MODs</a>:</p><ul><li>A simple change in it&rsquo;s package name (<em>thankfully a relatively quick fix!</em>)</li><li>The package is no longer available from the core &ldquo;out-of-the-box&rdquo; repositories (e.g. a 3rd party repos or edge/experimental/extra package streams need to be configured)</li><li>Package dependencies are unavailable in non-standard repositories</li><li>Support is dropped altogether - there is no way to locate the package or dependencies for a newer OS version</li></ul><p>This led us to a conversation about how we continue to support all the various prerequisites and configurations required when presented with a matrix of <a href=https://httpd.apache.org/docs/2.4/mod>Apache MODs</a> and <a href=https://forge.puppet.com/puppetlabs/apache/compatibility>compatible OSs</a>.
We could, if time permitted, ensure that we have the steps to install every version&mldr;of every MOD&mldr;on every OS&mldr;documented and implemented.</p><p>Time permitting&mldr;</p><h2 id=solution>Solution</h2><h3 id=test-support-policy>Test Support Policy</h3><p>Straight away, we realised that, in the future, we need to strictly time box the amount of time we spend attempting to configure the OS with the correct repositories and/or dependencies for any given MOD.
A rule of thumb was that if it&rsquo;s not available in the default repositories of the OS, or a common, well supported auxiliary repository (e.g. EPEL), then we are not going to pin down the very unique snowflake configuration required for that MOD.
There is always the concept of <a href=https://github.com/puppetlabs/puppetlabs-apache/blob/master/manifests/default_mods.pp>default MODs</a> in Apache and these will <a href=https://github.com/puppetlabs/puppetlabs-apache/blob/master/spec/acceptance/default_mods_spec.rb>remain supported</a> with the module, however, in future, we are going to evaluate how we proceed with a test failure with a much stricter time limit.</p><h3 id=mods-arent-supported-anymore>MODs aren&rsquo;t supported anymore!?</h3><p>Absolutely not! They are still supported! If you want to add support for a new MOD, we do ask that you also write an acceptance test too.
The IAC Team are always happy to help you with this process.</p><h3 id=i-cant-get-the-test-to-pass-on-all-platforms>I can&rsquo;t get the test to pass on all platforms!</h3><p>Yes - this is likely an issue you&rsquo;re going to run in to.
Kudos to those who chase down ALL the package, package dependencies and configurations required for ALL of the <a href=https://forge.puppet.com/puppetlabs/apache/compatibility>compatible platforms</a> of the Apache module.
Realistically, you will likely encounter a few OSs where it is beyond reasonable to try and get this MOD working.
In these scenarios, we&rsquo;ll start a conversation on the PR about what the acceptable minimum is for the change being proposed - there&rsquo;s no hard/fast rule here.</p><h3 id=weve-agreed-were-not-supporting-this-mod-on-this-os-version---what-now>We&rsquo;ve agreed we&rsquo;re not supporting this MOD on this OS version - what now?</h3><p>You may be familiar with <a href=https://relishapp.com/rspec/rspec-core/v/3-8/docs/filtering/conditional-filters>RSpec&rsquo;s conditional filtering</a>?
If not, <a href=https://github.com/puppetlabs/puppetlabs-apache/blob/51ce2adcfc231c6a78dda5cc59c2aaf4028bb5bd/spec/acceptance/mod_ldap_spec.rb#L4>here is an example</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>describe <span style=color:#f1fa8c>&#39;apache::mod::ldap&#39;</span>, <span style=color:#ff79c6>unless</span>: os<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>:family</span><span style=color:#ff79c6>]</span> <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;redhat&#39;</span> <span style=color:#ff79c6>&amp;&amp;</span> os<span style=color:#ff79c6>[</span><span style=color:#f1fa8c>:release</span><span style=color:#ff79c6>].</span>to_i <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>8</span> <span style=color:#ff79c6>do</span>
</code></pre></div><p>This will mean that this test will <strong>not</strong> run if the OS family is <code>RedHat</code> and the version is <code>8</code> or higher.
These work well, but, things can start to get messy when there is quite a narrow band of compatible OSs for a MOD.
Consider <a href=https://github.com/zmartzone/mod_auth_openidc/releases/tag/v2.4.3><code>v2.4.3</code> of <code>mod_auth_openidc</code></a> - we can see from the build artifacts' names that we &ldquo;officially&rdquo; have support for:</p><ul><li>Ubuntu 16.04</li><li>Ubuntu 18.04</li><li>Debian 10</li><li>RHEL 7</li></ul><p>This does not consider the fact that there are many other OSs derived from RHEL and other distro vendors / maintainers can port packages to their OS.
For example, after a bit more digging, I can see that the <code>mod_auth_openidc</code> package is available for the following OSs too:</p><ul><li>CentOS 7</li><li>CentOS 8 (via AppStream)</li><li>RHEL 8 (via AppStream)</li><li>Fedora 30</li><li>Fedora 31</li><li>Fedora 32</li></ul><p>This search was not exhaustive, and to make it so would require a lot more effort, which is part of the issue we find ourselves up against.
Still, we now have a list of platforms that we want to include/exclude from being tested - depending on how we look at it.
I&rsquo;m sure you can envisage that the filtering rule for this test is going to become pretty gnarly?
What if I were to also throw in some of the challenges the IAC team face, on top:</p><ul><li>Expanding test coverage uncovering more MOD / OS incompatibility</li><li>Some tests invoking a MOD load/configure indirectly whist testing other functionality</li><li>New OS support requirements</li></ul><h3 id=tagging-and-helper-methods>Tagging and Helper Methods</h3><p>We had to come up with some better solution than ridiculously complex filtering rules.
After some conversations and design reviews, we settled on an idea of using <a href=https://www.rubydoc.info/gems/yard/file/docs/blog_tags.md#note>YARD&rsquo;s note blog_tags</a>.
This gives us the benefit of:</p><ul><li>Keeping within the conventions already in use</li><li>Easy syntax to understand</li><li>Free documentation whilst we&rsquo;re at it</li></ul><p>All the class definitions for <a href=https://httpd.apache.org/docs/2.4/mod>Apache MODs</a> live under <a href=https://github.com/puppetlabs/puppetlabs-apache/tree/983b1fd3ff178d46145f4b8c0a88bae36dfad12b/manifests/mod><code>manifest/mod</code></a>.
This seemed like the most logical place for our blog_tags to live.
Next, we wanted to decide whether this was an &ldquo;opt-in&rdquo; or &ldquo;opt-out&rdquo; affair.
In the end, we determined that it would be best to &ldquo;opt-out&rdquo; and so, the tag became <code>Unsupported platforms</code>.
You can now define what platforms a given MOD will <em>not</em> be expected to run on:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#6272a4># @note Unsupported platforms: RedHat: 5, 6; Ubuntu: 14.04; SLES: all; Scientific: 11 SP1</span>
<span style=color:#ff79c6>class</span> apache<span style=color:#ff79c6>::</span>mod<span style=color:#ff79c6>::</span>actions {
    apache<span style=color:#ff79c6>::</span>mod { <span style=color:#f1fa8c>&#39;actions&#39;</span>: }
}
</code></pre></div><p>For a full overview of the tag syntax rules, see <a href=https://github.com/puppetlabs/puppetlabs-apache/blob/c726313dad64683d05465d2f978965ad14690f35/README.md#apache-mod-test--support-lifecycle>this section of the README</a> in the module.</p><p>When RSpec tests are kicked off in the module, we will parse the <code>Unsupported platform</code> blog_tags under <a href=https://github.com/puppetlabs/puppetlabs-apache/tree/983b1fd3ff178d46145f4b8c0a88bae36dfad12b/manifests/mod><code>manifest/mod</code></a> as part of the <code>Rspec.before</code> hooks and generate a mapping of MOD -> Unsupported Platforms.
Now, from within the tests, you can make use of the <code>mod_supported_on_platform</code> helper method to determine whether the test should run on a given platform or be filtered out:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>describe <span style=color:#f1fa8c>&#39;auth_oidc&#39;</span>, <span style=color:#ff79c6>if</span>: mod_supported_on_platform(<span style=color:#f1fa8c>&#39;apache::mod::auth_openidc&#39;</span>) <span style=color:#ff79c6>do</span>
</code></pre></div><p>Hopefully you&rsquo;ll agree that this is a much cleaner solution that a complex filtering rule?
For the IAC Team, it makes our life a lot easier, and hopefully means more frequent updates released for the Apache module for the community.</p><h4 id=want-more-details>Want more details?</h4><p>You can see the implementation on <a href=https://github.com/puppetlabs/puppetlabs-apache/pull/2036>#2036</a>, which has a detailed description outlining the functionality.
JIRA tickets <a href=https://tickets.puppetlabs.com/browse/IAC-801>IAC-801</a> and <a href=https://tickets.puppetlabs.com/browse/IAC-824>IAC-824</a> outline the design and implementation, respectively, should you wish to take a look.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/content-and-tooling-team/blog/posts/2020-03-30-debugging-unit-tests-with-honeycomb/ aria-label="Previous - Debugging unit-tests with Honeycomb" class="btn btn-primary"><span class=mr-1>←</span>Previous</a></li><a href=/content-and-tooling-team/blog/posts/2020-09-21-dsc-release/ aria-label="Next - DSC + Puppet: Arrived!" class="btn btn-primary">Next<span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/puppetize aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://puppetcommunity.slack.com/ aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/puppetlabs/content-and-tooling-team aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Puppet All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script><script src=/content-and-tooling-team/js/tabpane-persist.js></script><script src=/content-and-tooling-team/js/main.min.20a756bd86e5baf68cf7cef0159a97a60c58d42f04b8b13448fe311997b49fda.js integrity="sha256-IKdWvYbluvaM987wFZqXpgxY1C8EuLE0SP4xGZe0n9o=" crossorigin=anonymous></script></body></html>